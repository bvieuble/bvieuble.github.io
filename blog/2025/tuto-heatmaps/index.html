<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="NUK2RNw-uH6-2th-7YWdtPJhZGP2V_U11cBTumDXM5Y"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> LaTeX tuto - Heatmaps grid with Lua | Bastien Vieublé </title> <meta name="author" content="Bastien Vieublé"> <meta name="description" content="Learn to draw a grid of heatmaps using PGFPlots and Lua."> <meta name="keywords" content="high performance computing, numerical linear algebra, rounding errors, linear systems of equations"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.font.im/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/logo-amss.png?ba163e6a9247158fad73c7c469e3e91c"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://bvieuble.me/blog/2025/tuto-heatmaps/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Bastien</span> Vieublé </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/texfantasy/">TexFantasy </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/casanla/">CAS-ANLA </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">LaTeX tuto - Heatmaps grid with Lua</h1> <p class="post-meta"> Created in May 25, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/latex"> <i class="fa-solid fa-hashtag fa-sm"></i> latex</a>   <a href="/blog/tag/tutorial"> <i class="fa-solid fa-hashtag fa-sm"></i> tutorial</a>   ·   <a href="/blog/category/texfantasy"> <i class="fa-solid fa-tag fa-sm"></i> texfantasy</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <style>body{text-align:justify}</style> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/texfantasy/tuto_heatmaps_lua/tuto_heatmaps-480.webp 480w,/assets/img/texfantasy/tuto_heatmaps_lua/tuto_heatmaps-800.webp 800w,/assets/img/texfantasy/tuto_heatmaps_lua/tuto_heatmaps-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/texfantasy/tuto_heatmaps_lua/tuto_heatmaps.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="tutorial-use-lua-to-automate-a-grid-of-heatmaps">Tutorial: use Lua to automate a grid of heatmaps</h2> <p>Consider the above \(3\times 3\) grid of heatmaps, where each heatmap represents the number of iterations according to \(\kappa(A)\) and \(\kappa(M)\) for a given variant of a numerical algorithm (e.g., L-DSD, F-DBD, or R-SBS). A relatively naive way to draw this plot would be to write a dedicated PGFPlots script for each of the nine heatmaps. As you can imagine, this approach has some big limitations. More specifically:</p> <ul> <li>If you need to change the style of the heatmaps, you need to propagate the change nine times.</li> <li>The source code will be larger and larger the bigger the number of heatmaps is.</li> <li>The layout of the grid, the size of the grid, or the sources of the data cannot be changed simply.</li> </ul> <p>Ultimately, we wish to write the PGFPlots script defining the style of the heatmap once and apply it nine times. Doing so, we need to take into account that from one heatmap to another there can be slight variations of style; for instance, the labels of the x- and/or y-axis may or may not be diplayed depending on the position of the heatmap in the grid. In addition, we want a convenient way to set different options for generating the grid. Specifically, we want to be able to change the grid layout (not necessarily \(3\times 3\)), the heatmaps’ size, or the sources of the data through user input parameters.</p> <p><strong>Source code for the tuto:</strong> the full compilable sources of the tuto can be <a href="https://github.com/bvieuble/TeXFantasy/tree/main/heatmaps/fig1" rel="external nofollow noopener" target="_blank">downloaded from github</a>. One can compile it at the root of the directory with</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lualatex <span class="nt">--shell-escape</span> figure.tex
</code></pre></div></div> <p>The option <code class="language-plaintext highlighter-rouge">--shell-escape</code> is optional and is only used to generate a .png alongside the .pdf.</p> <p><strong>Prerequisites for the tuto:</strong></p> <ul> <li>Basic notions of Lua. The Lua tutorial of <a href="https://www.tutorialspoint.com/lua/index.htm" rel="external nofollow noopener" target="_blank">tutorialspoint</a> is a good start.</li> <li>Good notions of PGFPlots, TikZ, and LaTeX. Specifically: drawing PGFPlots axis and knowing some of the basic axis options; have a basic understanding of the LaTeX macro system. One can check the <a href="https://mirror-hk.koddos.net/CTAN/graphics/pgf/contrib/pgfplots/doc/pgfplots.pdf" rel="external nofollow noopener" target="_blank">PGFPlots manual</a> if they encounter an axis option or a <code class="language-plaintext highlighter-rouge">pgfplots</code> command they don’t know.</li> <li>Basic notions of Lua code injections in .tex document. The <a href="https://www.alanshawn.com/tech/2020/06/20/luatex-intro.html" rel="external nofollow noopener" target="_blank">Alan Xiang’s Blog</a> provides a compact and good introduction.</li> </ul> <p><strong>Origin of the figure:</strong> the figure appears in the scientific article <a href="https://hal.science/hal-05071696/" rel="external nofollow noopener" target="_blank">Mixed precision strategies for preconditioned GMRES: a comprehensive analysis</a>.</p> <h3 id="lua-automation">Lua automation</h3> <p>Achieving the above goals requires a little more than <em>“simple LaTeX”</em> since we need some form of automation. Notably:</p> <ul> <li>Given a grid layout and the size of the heatmaps, we need to compute the position of each heatmap in the figure, accounting for the spacing between two heatmaps.</li> <li>We need to compute the position and size of the colorbar.</li> <li>We need to decide which heatmap will display tick labels on the x- and y-axes. In our figure, we display only x-axis labels for the heatmaps at the very bottom, and we display only the y-axis labels for the heatmaps at the very left of the grid. This allows us to save space and render a figure which is more compact and more suited for scientific journals.</li> </ul> <h5 style="text-align: center;"> <em> This requires some scripting! </em> </h5> <p><br> While LaTeX already offers scripting capabilities through, for instance, the LaTeX3 commands and interfaces, or other utility commands found in various libraries such as the <code class="language-plaintext highlighter-rouge">\foreach</code> or <code class="language-plaintext highlighter-rouge">\pgfmathparse</code> of the package <code class="language-plaintext highlighter-rouge">pgfplots</code>, the syntax is arguably less intuitive and does not match the level of tools, efficiency, and simplicity that Lua can offer.</p> <h3 id="lua-based-config-file">Lua-based config file</h3> <p>We first tackle the problem of generating a grid of heatmaps given certain user input parameters. For this plot, we want the user to be able to set the following: the source of the data for each heatmap, the size of the heatmaps, and the number of heatmaps in one row of the grid.</p> <p>Naturally, it follows the question: how does the user provide values for these parameters? As for many things in LaTeX, there is no unanimous <em>“good answer”</em> on how to proceed, and different approaches are valid depending on the use cases and people’s preferences. I, your tutorial master and writer of this post, have a personal preference for defining those parameters in a separate Lua config file, which is simply a Lua module that will be loaded during the compilation. This has the advantage of clearly isolating the user inputs in one dedicated place, and to not have to be stored with the rest of the LaTeX source. In this tuto, we call this file <code class="language-plaintext highlighter-rouge">config.lua</code>, and you can find its content below:</p> <figure class="highlight"><pre><code class="language-lua" data-lang="lua"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td> <td class="code"><pre><span class="c1">-- config.lua</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">config</span><span class="p">.</span><span class="n">gridcols</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">config</span><span class="p">.</span><span class="n">relativesize</span> <span class="o">=</span> <span class="p">.</span><span class="mi">31</span>
<span class="n">config</span><span class="p">.</span><span class="n">dircsv</span> <span class="o">=</span> <span class="s2">"./data"</span>
<span class="n">config</span><span class="p">.</span><span class="n">plots</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span><span class="s2">"left_sbs"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{l-sbs}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"right_sbs"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{r-sbs}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"flexible_sbs"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{f-sbs}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"left_dbd"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{l-dbd}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"right_dbd"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{r-dbd}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"flexible_dbd"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{f-dbd}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"left_dsd"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{l-dsd}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"right_dsd"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{r-dsd}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"flexible_dsd"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{f-dsd}"</span><span class="p">},</span>
<span class="p">}</span>

<span class="k">return</span> <span class="n">config</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>In <code class="language-plaintext highlighter-rouge">config.lua</code>, the structure</p> <div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="c1">-- [...]</span>
<span class="k">return</span> <span class="n">config</span>
</code></pre></div></div> <p>defines a Lua module; this is simply a table of key-value referenced as <code class="language-plaintext highlighter-rouge">config</code>. Inside the table <code class="language-plaintext highlighter-rouge">config</code>, we define different keys carrying our user input parameters:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">gridcols</code> is the number of heatmaps on each row.</li> <li> <code class="language-plaintext highlighter-rouge">relativesize</code> defines the common size of all individual heatmaps. The true size of each heatmap in the document is <code class="language-plaintext highlighter-rouge">relativesize</code> \(\times\) <code class="language-plaintext highlighter-rouge">\linewidth</code>.</li> <li> <code class="language-plaintext highlighter-rouge">dircsv</code> sets the path to the directory containing the heatmaps’ plot data in the form of .csv files.</li> <li> <code class="language-plaintext highlighter-rouge">plots</code> is the list of the heatmaps to be plotted. They are defined with a pair of strings. Each pair of strings is composed, first, of the name of the corresponding .csv file containing the plot data and, second, the name/title of each heatmap to be displayed in the top right corner of the plot (e.g., L-DSD, F-DBD, or R-SBS).</li> </ul> <p>Our data directory <code class="language-plaintext highlighter-rouge">dircsv</code> looks as follows:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dircsv
├── bounds
│  ├── left_sbs.csv
│  ├── right_sbs.csv
│  └── ...
└──iterations 
    ├── left_sbs.csv
    ├── right_sbs.csv
    └── ...
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">dircsv/bounds/</code> subdirectory contains the .csv specifying which tiles of a given heatmap have a white dot. The <code class="language-plaintext highlighter-rouge">dircsv/iterations/</code> subdirectory contains the .csv that defines the number of iterations achieved on each tile.</p> <h3 id="compute-the-grid-layout-with-lua">Compute the grid layout with Lua</h3> <p>It is generally good practice to keep the Lua scripting out of the .tex file as much as possible. For this tutorial, we create a simple Lua module in a separate file <code class="language-plaintext highlighter-rouge">utils.lua</code> containing the function <code class="language-plaintext highlighter-rouge">get_grid(...)</code>. Based on the inputs provided by the user, this function will provide three main information to the main .tex file:</p> <ul> <li>The position of each heatmap in the grid.</li> <li>Tell if the x- and/or y-axis labels should be displayed for a given heatmap.</li> <li>The position and the size of the colorbar.</li> </ul> <p>The results are passed to the .tex file through the <code class="language-plaintext highlighter-rouge">grid</code> object, which is a table of key-value. The full details of the <code class="language-plaintext highlighter-rouge">utils.lua</code> module file is displayed below.</p> <figure class="highlight"><pre><code class="language-lua" data-lang="lua"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre></td> <td class="code"><pre><span class="c1">-- utils.lua</span>

<span class="kd">local</span> <span class="n">utils</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nc">utils</span><span class="p">.</span><span class="nf">get_grid</span><span class="p">(</span><span class="n">nbelt</span><span class="p">,</span> <span class="n">nbcols</span><span class="p">,</span> <span class="n">relativesize</span><span class="p">)</span>

  <span class="c1">-- Variables declaration</span>
  <span class="kd">local</span> <span class="n">grid</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="kd">local</span> <span class="n">coordx</span><span class="p">,</span> <span class="n">coordy</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
  <span class="kd">local</span> <span class="n">xtick</span><span class="p">,</span> <span class="n">xticklabel</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
  <span class="kd">local</span> <span class="n">ytick</span><span class="p">,</span> <span class="n">yticklabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
  <span class="kd">local</span> <span class="n">sepx</span>   <span class="o">=</span> <span class="n">relativesize</span> <span class="o">/</span> <span class="mi">5</span>
  <span class="kd">local</span> <span class="n">sepy</span>   <span class="o">=</span> <span class="n">relativesize</span> <span class="o">/</span> <span class="mi">5</span>
  <span class="kd">local</span> <span class="n">cbarx</span><span class="p">,</span> <span class="n">cbary</span><span class="p">,</span> <span class="n">cbarsizeh</span><span class="p">,</span> <span class="n">cbarsizew</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

  <span class="c1">-- For each heatmap, compute its position in the grid and decide to display </span>
  <span class="c1">-- or not the x- and/or y-axis labels.</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nbelt</span><span class="p">,</span> <span class="mi">1</span>
  <span class="k">do</span>
    <span class="n">xtick</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>  <span class="n">xticklabel</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xlabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"{}"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"{}"</span>
    <span class="n">ytick</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>  <span class="n">yticklabel</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ylabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"{}"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"{}"</span>
    <span class="kd">local</span> <span class="n">row</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">(((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">nbcols</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">relativesize</span> <span class="o">+</span> <span class="n">sepy</span><span class="p">))</span>
    <span class="kd">local</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">nbcols</span>
    <span class="k">if</span> <span class="n">nbcols</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">then</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">end</span>
    <span class="kd">local</span> <span class="n">col</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">((</span><span class="n">tmp</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">relativesize</span> <span class="o">+</span> <span class="n">sepx</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">tmp</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
      <span class="n">col</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">((</span><span class="n">nbcols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">relativesize</span> <span class="o">+</span> <span class="n">sepx</span><span class="p">))</span>
    <span class="k">elseif</span> <span class="n">tmp</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">then</span>
      <span class="n">yticklabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">ylabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"{$\\kappa(M)$}"</span>
    <span class="k">end</span>

    <span class="c1">-- Choose the tick labels density. If the size of the heatmap is small we</span>
    <span class="c1">-- display less tick labels, if this is big we display more.</span>
    <span class="k">if</span> <span class="n">relativesize</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">3</span> <span class="k">then</span>
      <span class="n">xtick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"{1,9,17}"</span>
      <span class="n">ytick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"{1,9,17}"</span>
    <span class="k">elseif</span> <span class="n">relativesize</span> <span class="o">&lt;</span> <span class="p">.</span><span class="mi">7</span> <span class="k">then</span>
      <span class="n">xtick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"{1,5,9,13,17}"</span>
      <span class="n">ytick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"{1,5,9,13,17}"</span>
    <span class="k">elseif</span> <span class="n">relativesize</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">.</span> <span class="k">then</span>
      <span class="n">xtick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"{1,3,5,7,9,11,13,15,17}"</span>
      <span class="n">ytick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"{1,3,5,7,9,11,13,15,17}"</span>
    <span class="k">else</span>
      <span class="n">xtick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"{1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17}"</span>
      <span class="n">ytick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"{1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17}"</span>
    <span class="k">end</span>

    <span class="n">coordx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span> <span class="o">..</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">linewidth"</span>
    <span class="n">coordy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span> <span class="o">..</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">linewidth"</span>
  <span class="k">end</span>

  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nbcols</span><span class="p">,</span> <span class="mi">1</span>
  <span class="k">do</span>
    <span class="n">xticklabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">xlabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"{$\\kappa(A)$}"</span>
  <span class="k">end</span>

  <span class="c1">-- Compute the location and the size of the colorbar. The colorbar is located </span>
  <span class="c1">-- at the top of the grid.</span>
  <span class="n">cbarx</span> <span class="o">=</span> <span class="p">(</span><span class="n">nbcols</span> <span class="o">*</span> <span class="p">(</span><span class="n">relativesize</span> <span class="o">+</span> <span class="n">sepx</span><span class="p">)</span> <span class="o">-</span> <span class="n">sepx</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">nbelt</span> <span class="o">%</span> <span class="n">nbcols</span><span class="p">)</span> <span class="o">~=</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="n">cbary</span> <span class="o">=</span> <span class="p">(</span><span class="n">nbelt</span> <span class="o">//</span> <span class="n">nbcols</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">relativesize</span> <span class="o">+</span> <span class="n">sepy</span><span class="p">)</span> <span class="o">-</span> <span class="n">sepy</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">35</span> <span class="o">*</span> <span class="n">relativesize</span>
  <span class="k">else</span>
    <span class="n">cbary</span> <span class="o">=</span> <span class="p">(</span><span class="n">nbelt</span> <span class="o">//</span> <span class="n">nbcols</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">relativesize</span> <span class="o">+</span> <span class="n">sepy</span><span class="p">)</span> <span class="o">-</span> <span class="n">sepy</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">35</span> <span class="o">*</span> <span class="n">relativesize</span>
  <span class="k">end</span>
  <span class="n">cbarsizew</span> <span class="o">=</span> <span class="p">(</span><span class="n">nbcols</span> <span class="o">*</span> <span class="p">(</span><span class="n">relativesize</span> <span class="o">+</span> <span class="n">sepx</span><span class="p">)</span> <span class="o">-</span> <span class="n">sepx</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">7</span>
  <span class="n">cbarsizeh</span> <span class="o">=</span> <span class="n">relativesize</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">065</span>

  <span class="c1">-- Put the variables in a table grid for convenience.</span>
  <span class="n">grid</span><span class="p">.</span><span class="n">coordx</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">coordy</span> <span class="o">=</span> <span class="n">coordx</span><span class="p">,</span> <span class="n">coordy</span>
  <span class="n">grid</span><span class="p">.</span><span class="n">xtick</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">xticklabel</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">xlabel</span>  <span class="o">=</span> <span class="n">xtick</span><span class="p">,</span> <span class="n">xticklabel</span><span class="p">,</span> <span class="n">xlabel</span>
  <span class="n">grid</span><span class="p">.</span><span class="n">ytick</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">yticklabel</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">ylabel</span>  <span class="o">=</span> <span class="n">ytick</span><span class="p">,</span> <span class="n">yticklabel</span><span class="p">,</span> <span class="n">ylabel</span>
  <span class="n">grid</span><span class="p">.</span><span class="n">cbarx</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">cbary</span> <span class="o">=</span> <span class="n">cbarx</span><span class="p">,</span> <span class="n">cbary</span>
  <span class="n">grid</span><span class="p">.</span><span class="n">cbarsizew</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="n">cbarsizeh</span> <span class="o">=</span> <span class="n">cbarsizew</span><span class="p">,</span> <span class="n">cbarsizeh</span>
  <span class="k">return</span> <span class="n">grid</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">utils</span>
</pre></td> </tr></tbody></table></code></pre></figure> <h3 id="overview-of-the-main-lualatex-code">Overview of the main LuaLaTeX code</h3> <p>We present the main LuaLaTeX code below that will generate the grid of heatmaps. One can compile the figure with</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lualatex <span class="nt">--shell-escape</span> heatmaps.tex
</code></pre></div></div> <p>The option <code class="language-plaintext highlighter-rouge">--shell-escape</code> is not essential and is only used to generate a .png alongside the .pdf. The overall is embedded in a <code class="language-plaintext highlighter-rouge">standalone</code> LaTeX document class, which is generally the way to go to draw and generate figures outside of a main LaTeX document. Through the <code class="language-plaintext highlighter-rouge">\includestandalone{figure}</code> command, it is also straightforward to embed this figure into another LaTeX document (e.g., article, beamer, book, etc.).</p> <figure class="highlight"><pre><code class="language-latex" data-lang="latex"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
</pre></td> <td class="code"><pre><span class="c">% figure.tex</span>

<span class="k">\documentclass</span><span class="na">[convert={outext=.png},border=10pt]</span><span class="p">{</span>standalone<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>fontspec<span class="p">}</span>
<span class="k">\setmainfont</span><span class="p">{</span>Roboto<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>pgfplots<span class="p">}</span>
<span class="k">\pgfplotsset</span><span class="p">{</span>compat=newest<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>luacode<span class="p">}</span>

<span class="k">\definecolor</span><span class="p">{</span>fg<span class="p">}{</span>RGB<span class="p">}{</span>150,150,150<span class="p">}</span> <span class="c">% Foreground color</span>
<span class="k">\pgfplotsset</span><span class="p">{</span>filter discard warning=false<span class="p">}</span>

<span class="nt">\begin{document}</span>
<span class="c">%</span>
<span class="k">\pgfplotsset</span><span class="p">{</span>title style=<span class="p">{</span>xshift=1cm,yshift=-0.2cm<span class="p">}}</span><span class="c">%</span>
<span class="c">%</span>
<span class="k">\pgfmathdeclarefunction</span><span class="p">{</span>lg10<span class="p">}{</span>1<span class="p">}{</span> <span class="c">%</span>
    <span class="k">\pgfmathparse</span><span class="p">{</span>ln(#1)/ln(10)<span class="p">}</span><span class="c">%</span>
<span class="p">}</span><span class="c">%</span>
<span class="c">%</span>
<span class="c">% Load utils.lua and config.lua.</span>
<span class="nt">\begin{luacode*}</span>
  -- utils.lua contains lua functions to be called to be called in this file.
  myutils = require("utils")
  -- config.lua contains the user input parameters.
  myconfig = require("config")
<span class="nt">\end{luacode*}</span>
<span class="c">%</span>
<span class="c">% Define a LaTeX command that generates one heatmap. Inside the command, there</span>
<span class="c">% are various macros that define style options and data paths, such as,</span>
<span class="c">% "\varxtick", "\varsize" or "\vardatait". These macros should be initialized </span>
<span class="c">% before calling the \heatmaps command.</span>
<span class="k">\newcommand</span><span class="p">{</span><span class="k">\heatmap</span><span class="p">}</span>
<span class="p">{</span> <span class="c">%</span>
  <span class="nt">\begin{axis}</span>[
    <span class="c">% x-axis style</span>
    minor xtick=<span class="p">{</span>1.5,2.5,...,16.5<span class="p">}</span>,
    x label style=<span class="p">{</span>font=<span class="k">\normalsize</span><span class="p">}</span>,
    xtick=<span class="k">\varxtick</span>, <span class="c">% Recover x-ticks positions from macro</span>
    xticklabel=<span class="p">{</span>
     <span class="k">\if\varxticklabel</span> 1
       <span class="k">\pgfmathparse</span><span class="p">{</span><span class="k">\tick</span>-1<span class="p">}</span>
       <span class="p">$</span><span class="m">10</span><span class="p">^{</span><span class="nv">\pgfmathprintnumber</span><span class="p">{</span><span class="nv">\pgfmathresult</span><span class="p">}}$</span>
     <span class="k">\fi</span>
    <span class="p">}</span>,
    x tick label style=<span class="p">{</span>font=<span class="k">\small</span><span class="p">}</span>,
    xlabel=<span class="k">\varxlabel</span>, <span class="c">% Recover the x-axis label from macro</span>
    enlarge x limits=<span class="p">{</span>abs=0.<span class="p">}</span>,
    <span class="c">% y-axis style</span>
    minor ytick=<span class="p">{</span>1.5,2.5,...,16.5<span class="p">}</span>,
    y label style=<span class="p">{</span>at=<span class="p">{</span>(axis description cs:-0.15,0.5)<span class="p">}</span>,rotate=0,font=<span class="k">\normalsize</span><span class="p">}</span>,
    ytick=<span class="p">{</span><span class="k">\varytick</span><span class="p">}</span>, <span class="c">% Recover y-ticks positions from macro</span>
    yticklabel=<span class="p">{</span>
     <span class="k">\if\varyticklabel</span> 1
       <span class="k">\pgfmathparse</span><span class="p">{</span><span class="k">\tick</span>-1<span class="p">}</span>
       <span class="p">$</span><span class="m">10</span><span class="p">^{</span><span class="nv">\pgfmathprintnumber</span><span class="p">{</span><span class="nv">\pgfmathresult</span><span class="p">}}$</span>
     <span class="k">\fi</span>
    <span class="p">}</span>,
    y tick label style=<span class="p">{</span>font=<span class="k">\small</span>,rotate=90<span class="p">}</span>,
    ylabel=<span class="k">\varylabel</span>, <span class="c">% Recover the y-axis label from macro</span>
    enlarge y limits=<span class="p">{</span>abs=0.<span class="p">}</span>,
    <span class="c">% Other style</span>
    grid=minor,
    tick style=<span class="p">{</span>draw=none<span class="p">}</span>, <span class="c">% Hide the ticks</span>
    minor grid style=<span class="p">{</span>fg,very thin<span class="p">}</span>,
    axis on top,
    mesh/ordering=y varies, 
    unbounded coords=jump,
    height=<span class="k">\varsize\linewidth</span>, <span class="c">% Set the size (height and width) from macro</span>
    width=<span class="k">\varsize\linewidth</span>,
    colormap=<span class="p">{</span>whiteblue<span class="p">}{</span>color=<span class="p">{</span>black<span class="p">}</span> color=(white)<span class="p">}</span>,
    point meta min=0,
    point meta max=4,
    view=<span class="p">{</span>0<span class="p">}{</span>90<span class="p">}</span>,
    scale only axis=true, <span class="c">% Enforce the paramaters height and width to describe</span>
                          <span class="c">% the size of the axis without including the </span>
                          <span class="c">% decorations</span>
    title=<span class="k">\textsc</span><span class="p">{</span><span class="k">\vartitle</span><span class="p">}</span>, <span class="c">% Recover the name of the heatmap from macro</span>
    at=<span class="p">{</span>(<span class="k">\varcoordx</span>,<span class="k">\varcoordy</span>)<span class="p">}</span>, <span class="c">% Recover the position of the heatmap from</span>
                                  <span class="c">% macro</span>
  ]<span class="c">%</span>
  <span class="k">\addplot</span><span class="na">[matrix plot*,mesh/rows=17,point meta=explicit]</span>
      table[meta expr=lg10(<span class="k">\thisrow</span><span class="p">{</span>it<span class="p">}</span>),col sep=comma]
      <span class="p">{</span><span class="k">\vardatait</span><span class="p">}</span>; <span class="c">% Obtain the data path from macro</span>
  <span class="k">\addplot</span><span class="na">[white,only marks,mark=*,mark size=0.75pt]</span> 
      table[col sep=comma] <span class="p">{</span><span class="k">\vardatabounds</span><span class="p">}</span>; <span class="c">% Obtain the data path from macro</span>
  <span class="nt">\end{axis}</span>
<span class="p">}</span><span class="c">%</span>
<span class="c">%</span>
<span class="c">% Define a LaTeX command that generates the colorbar. Because all the heatmaps</span>
<span class="c">% of the grid share the same colorbar, we need to define the colorbar as a</span>
<span class="c">% standalone, outside of the heatmap plots. To do so we use the </span>
<span class="c">% `\pgfplotscolorbardrawstandalone[...].`</span>
<span class="k">\newcommand</span><span class="p">{</span><span class="k">\heatcolorbar</span><span class="p">}</span>
<span class="p">{</span> <span class="c">%</span>
  <span class="k">\pgfplotscolorbardrawstandalone</span>[
    colormap=<span class="p">{</span>whiteblue<span class="p">}{</span>color=<span class="p">{</span>black<span class="p">}</span> color=(white)<span class="p">}</span>,
    point meta min=0,
    point meta max=3.68,
    colorbar horizontal,
    colorbar style=<span class="p">{</span>
       ylabel=<span class="p">{</span><span class="k">\#</span>it<span class="p">}</span>,
       yticklabel pos=upper,
       ylabel style=<span class="p">{</span>rotate=-90, xshift=.22cm<span class="p">}</span>,
       xtick=<span class="p">{</span>0,1,1.7,2,2.70,3,3.68<span class="p">}</span>,
       xticklabels=<span class="p">{$</span><span class="m">1</span><span class="nb">e</span><span class="m">0</span><span class="p">$</span>, <span class="p">$</span><span class="m">1</span><span class="nb">e</span><span class="m">1</span><span class="p">$</span>, <span class="p">$</span><span class="m">5</span><span class="nb">e</span><span class="m">1</span><span class="p">$</span>, <span class="p">$</span><span class="m">1</span><span class="nb">e</span><span class="m">2</span><span class="p">$</span>, <span class="p">$</span><span class="m">5</span><span class="nb">e</span><span class="m">2</span><span class="p">$</span>, <span class="p">$</span><span class="m">1</span><span class="nb">e</span><span class="m">3</span><span class="p">$</span>, <span class="p">$</span><span class="m">5</span><span class="nb">e</span><span class="m">3</span><span class="p">$}</span>,
       x tick label style=<span class="p">{</span>font=<span class="k">\footnotesize</span><span class="p">}</span>,
       xticklabel pos=upper,
       at=<span class="p">{</span>(<span class="k">\varcbarx\linewidth</span>,<span class="k">\varcbary\linewidth</span>)<span class="p">}</span>, 
       width=<span class="k">\varcbarsizew\linewidth</span>,
       anchor=center, <span class="c">% The position of the colorbar defined with `at` is now</span>
       <span class="c">% based on the center of the figure rather than the left bottom corner</span>
    <span class="p">}</span>,
    colorbar/width=<span class="k">\varcbarsizeh\linewidth</span>,
    colormap access=map,
  ]<span class="c">%</span>
<span class="p">}</span><span class="c">%</span>
<span class="c">%</span>
<span class="nt">\begin{tikzpicture}</span>[fg]
  <span class="nt">\begin{luacode*}</span>

    -- Get the grid information based on the user input parameters in
    -- config.lua and computed from the function `get<span class="p">_</span>grid<span class="p">_</span>heatmaps(...)`
    -- loaded from utils.lua.
    grid = myutils.get<span class="p">_</span>grid(#myconfig.plots, myconfig.gridcols,
                            myconfig.relativesize)

    -- Loop over the heatmaps
    for i = 1, #myconfig.plots
    do
      
      -- Extract name of the heatmap and the source of the data from config.lua
      title   = myconfig.plots[i][2]
      pathcsv<span class="p">_</span>it = myconfig.dircsv .. "/iterations/" ..  myconfig.plots[i][1] 
        .. ".csv"
      pathcsv<span class="p">_</span>bounds = myconfig.dircsv .. "/bounds/" .. myconfig.plots[i][1] 
        .. ".csv"
      
      -- Set the LaTeX macros that will define the style of the current heatmap
      tex.print("<span class="k">\\</span>def<span class="k">\\</span>vardatait<span class="p">{</span>"       .. pathcsv<span class="p">_</span>it             .. "<span class="p">}</span>")
      tex.print("<span class="k">\\</span>def<span class="k">\\</span>vardatabounds<span class="p">{</span>"   .. pathcsv<span class="p">_</span>bounds         .. "<span class="p">}</span>")
      tex.print("<span class="k">\\</span>def<span class="k">\\</span>vartitle<span class="p">{</span>"        .. title                  .. "<span class="p">}</span>")
      tex.print("<span class="k">\\</span>def<span class="k">\\</span>varcoordx<span class="p">{</span>"       .. grid.coordx[i]         .. "<span class="p">}</span>")
      tex.print("<span class="k">\\</span>def<span class="k">\\</span>varcoordy<span class="p">{</span>"       .. grid.coordy[i]         .. "<span class="p">}</span>")
      tex.print("<span class="k">\\</span>def<span class="k">\\</span>varsize<span class="p">{</span>"         .. myconfig.relativesize  .. "<span class="p">}</span>")
      tex.print("<span class="k">\\</span>def<span class="k">\\</span>varxtick<span class="p">{</span>"        .. grid.xtick[i]          .. "<span class="p">}</span>")
      tex.print("<span class="k">\\</span>def<span class="k">\\</span>varxticklabel<span class="p">{</span>"   .. grid.xticklabel[i]     .. "<span class="p">}</span>")
      tex.print("<span class="k">\\</span>def<span class="k">\\</span>varxlabel<span class="p">{</span>"       .. grid.xlabel[i]         .. "<span class="p">}</span>")
      tex.print("<span class="k">\\</span>def<span class="k">\\</span>varytick<span class="p">{</span>"        .. grid.ytick[i]          .. "<span class="p">}</span>")
      tex.print("<span class="k">\\</span>def<span class="k">\\</span>varyticklabel<span class="p">{</span>"   .. grid.yticklabel[i]     .. "<span class="p">}</span>")
      tex.print("<span class="k">\\</span>def<span class="k">\\</span>varylabel<span class="p">{</span>"       .. grid.ylabel[i]         .. "<span class="p">}</span>")

      -- Generate the current heatmap
      tex.print("<span class="k">\\</span>heatmap")
    end

    -- Set the LaTeX macros that will define the style of the colorbar
    tex.print("<span class="k">\\</span>def<span class="k">\\</span>varcbarx<span class="p">{</span>"      .. grid.cbarx     .. "<span class="p">}</span>")
    tex.print("<span class="k">\\</span>def<span class="k">\\</span>varcbary<span class="p">{</span>"      .. grid.cbary     .. "<span class="p">}</span>")
    tex.print("<span class="k">\\</span>def<span class="k">\\</span>varcbarsizew<span class="p">{</span>"  .. grid.cbarsizew .. "<span class="p">}</span>")
    tex.print("<span class="k">\\</span>def<span class="k">\\</span>varcbarsizeh<span class="p">{</span>"  .. grid.cbarsizeh .. "<span class="p">}</span>")

    -- Generate the colorbar
    tex.print("<span class="k">\\</span>heatcolorbar")

  <span class="nt">\end{luacode*}</span>
<span class="nt">\end{tikzpicture}</span><span class="c">%</span>
<span class="nt">\end{document}</span>
</pre></td> </tr></tbody></table></code></pre></figure> <h5 style="text-align: center;"> <em> Let's describe the file and its logic piece by piece, from top to bottom. </em> </h5> <p><br> After the document class declaration, we load the different useful packages to compile the figure. The dependencies are relatively lightweight; we mostly need two main LaTeX packages (note that internally each of these two packages loads other packages):</p> <div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\usepackage</span><span class="p">{</span>pgfplots<span class="p">}</span> <span class="c">% LaTeX package to generate a wide diversity of </span>
                      <span class="c">% scientific plots.</span>
<span class="k">\usepackage</span><span class="p">{</span>luacode<span class="p">}</span>  <span class="c">% A set of environments and commands to ease the </span>
                      <span class="c">% Lua-LaTeX interfacing.</span>
</code></pre></div></div> <p>Once in the document’s body, we load our two Lua modules <code class="language-plaintext highlighter-rouge">config.lua</code> and <code class="language-plaintext highlighter-rouge">utils.lua</code> described in, respectively, <a href="#lua-based-config-file">Lua-based config file</a> and <a href="#compute-the-grid-layout-with-lua">Compute the grid layout with Lua</a>. We load the modules as we would do it in standard Lua by writing</p> <div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">myutils</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"utils"</span><span class="p">)</span>
<span class="n">myconfig</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"config"</span><span class="p">)</span>
</code></pre></div></div> <p>in a <code class="language-plaintext highlighter-rouge">\begin{luacode*} [...] \end{luacode*}</code> LaTeX environment, which is the environment in which Lua scripts can be executed inside a .tex document. The different functions and variables defined in the modules are now conveniently accessible through the namespaces <code class="language-plaintext highlighter-rouge">myutils</code> and <code class="language-plaintext highlighter-rouge">myconfig</code>.</p> <p>We then define the <em>“pure LaTeX”</em> command</p> <div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\newcommand</span><span class="p">{</span><span class="k">\heatmap</span><span class="p">}{</span>
  <span class="c">% [...]</span>
<span class="p">}</span>
</code></pre></div></div> <p>which serves to plot the heatmaps of the grid. The advantage of embedding the style of the heatmaps into one LaTeX command is that we can write the style only once and apply it multiple times.</p> <p>However, as explained previously, the different heatmaps of the grid do not have exactly the same style; for example, titles, positions, or tick labels can change from one heatmap to another. A simple approach to address this issue is to pass this information as parameters of the command. For instance, by declaring the command as <code class="language-plaintext highlighter-rouge">\newcommand{\heatmap}[2]{...}</code>, the command <code class="language-plaintext highlighter-rouge">\heatmap</code> takes now two parameters. Unfortunately, a LaTeX command can only accept up to nine parameters, which cannot suit our use case here; see this <a href="https://tex.stackexchange.com/questions/2132/how-to-define-a-command-that-takes-more-than-9-arguments" rel="external nofollow noopener" target="_blank">StackExchange question</a>. There are different ways to overcome this problem. We chose to rely on a LaTeX macro approach for this tutorial. With this approach, the command <code class="language-plaintext highlighter-rouge">\heatmap</code> is defined without parameters, but internally uses a set of LaTeX macros used as variables: <code class="language-plaintext highlighter-rouge">\varxtick</code>, <code class="language-plaintext highlighter-rouge">\varxlabel</code>, <code class="language-plaintext highlighter-rouge">\varsize</code>, <code class="language-plaintext highlighter-rouge">\vardatait</code>, etc. For instance, the macro <code class="language-plaintext highlighter-rouge">\varsize</code> is used to set the size of the heatmap; the macro <code class="language-plaintext highlighter-rouge">\vardatait</code> sets the path to the .csv file containing the data to be plotted. These macros can be redefined between each call of the command <code class="language-plaintext highlighter-rouge">\heatmap</code>, which allows us to change the style from heatmap to heatmap.</p> <p>We define another command</p> <div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\newcommand</span><span class="p">{</span><span class="k">\heatcolorbar</span><span class="p">}{</span>
  <span class="c">% [...]</span>
<span class="p">}</span>
</code></pre></div></div> <p>which works similarly to <code class="language-plaintext highlighter-rouge">\heatmap</code>. This command plots the colorbar of the figure. In more standard use cases, the colorbar is defined inside the <code class="language-plaintext highlighter-rouge">axis</code> environment of the plot. However, in our case, as the colorbar is shared across all the heatmaps of the grid, we use <code class="language-plaintext highlighter-rouge">\pgfplotscolorbardrawstandalone</code> to draw it as a standalone, which gives us more flexibility.</p> <p>Finally, we enter the definition of the TikZpicture which is fully automated by Lua instructions:</p> <div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{tikzpicture}</span>[fg]
  <span class="nt">\begin{luacode*}</span>
    <span class="c">% [...]</span>
  <span class="nt">\end{luacode*}</span>
<span class="nt">\end{tikzpicture}</span>
</code></pre></div></div> <p>We first call</p> <div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grid</span> <span class="o">=</span> <span class="n">myutils</span><span class="p">.</span><span class="n">get_grid</span><span class="p">(</span><span class="o">#</span><span class="n">myconfig</span><span class="p">.</span><span class="n">plots</span><span class="p">,</span> <span class="n">myconfig</span><span class="p">.</span><span class="n">gridcols</span><span class="p">,</span> <span class="n">myconfig</span><span class="p">.</span><span class="n">relativesize</span><span class="p">)</span>
</code></pre></div></div> <p>which <a href="#compute-the-grid-layout-with-lua">computes the grid layout</a> based on the <a href="#lua-based-config-file">user input parameters of the config file</a>. With the grid layout information computed and stored in a Lua table <code class="language-plaintext highlighter-rouge">grid</code>, we then loop over the heatmaps, set the variables defining the style of the current heatmap with</p> <div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\vardatait{"</span>       <span class="o">..</span> <span class="n">pathcsv_it</span>             <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\vardatabounds{"</span>   <span class="o">..</span> <span class="n">pathcsv_bounds</span>         <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\vartitle{"</span>        <span class="o">..</span> <span class="n">title</span>                  <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varcoordx{"</span>       <span class="o">..</span> <span class="n">grid</span><span class="p">.</span><span class="n">coordx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>         <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varcoordy{"</span>       <span class="o">..</span> <span class="n">grid</span><span class="p">.</span><span class="n">coordy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>         <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varsize{"</span>         <span class="o">..</span> <span class="n">myconfig</span><span class="p">.</span><span class="n">relativesize</span>  <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varxtick{"</span>        <span class="o">..</span> <span class="n">grid</span><span class="p">.</span><span class="n">xtick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>          <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varxticklabel{"</span>   <span class="o">..</span> <span class="n">grid</span><span class="p">.</span><span class="n">xticklabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>     <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varxlabel{"</span>       <span class="o">..</span> <span class="n">grid</span><span class="p">.</span><span class="n">xlabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>         <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varytick{"</span>        <span class="o">..</span> <span class="n">grid</span><span class="p">.</span><span class="n">ytick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>          <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varyticklabel{"</span>   <span class="o">..</span> <span class="n">grid</span><span class="p">.</span><span class="n">yticklabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>     <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varylabel{"</span>       <span class="o">..</span> <span class="n">grid</span><span class="p">.</span><span class="n">ylabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>         <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
</code></pre></div></div> <p>and generate the current heatmap by calling</p> <div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">heatmap"</span><span class="p">)</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">tex.print(...)</code> Lua function is one of the main way for Lua to provide materials to be read and interpreted by LaTeX. It basically pushes the string in parameter of <code class="language-plaintext highlighter-rouge">tex.print</code> in the TeX input buffer. Hence, with the previous set of Lua instructions, the LaTeX compiler will see</p> <div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\def\vardatait</span><span class="p">{</span>...<span class="p">}</span>
<span class="k">\def\vardatabounds</span><span class="p">{</span>...<span class="p">}</span>
<span class="k">\def\vartitle</span><span class="p">{</span>...<span class="p">}</span>
<span class="k">\def\varcoordx</span><span class="p">{</span>...<span class="p">}</span>
<span class="k">\def\varcoordy</span><span class="p">{</span>...<span class="p">}</span>
<span class="k">\def\varsize</span><span class="p">{</span>...<span class="p">}</span>
<span class="k">\def\varxtick</span><span class="p">{</span>...<span class="p">}</span>
<span class="k">\def\varxticklabel</span><span class="p">{</span>...<span class="p">}</span>
<span class="k">\def\varxlabel</span><span class="p">{</span>...<span class="p">}</span>
<span class="k">\def\varytick</span><span class="p">{</span>...<span class="p">}</span>
<span class="k">\def\varyticklabel</span><span class="p">{</span>...<span class="p">}</span>
<span class="k">\def\varylabel</span><span class="p">{</span>...<span class="p">}</span>

<span class="k">\heatmap</span>
</code></pre></div></div> <p>At the very end, once all the heatmaps are generated, we generate the colorbar in a very similar fashion:</p> <div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varcbarx{"</span>      <span class="o">..</span> <span class="n">grid</span><span class="p">.</span><span class="n">cbarx</span>     <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varcbary{"</span>      <span class="o">..</span> <span class="n">grid</span><span class="p">.</span><span class="n">cbary</span>     <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varcbarsizew{"</span>  <span class="o">..</span> <span class="n">grid</span><span class="p">.</span><span class="n">cbarsizew</span> <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>
<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">def\\varcbarsizeh{"</span>  <span class="o">..</span> <span class="n">grid</span><span class="p">.</span><span class="n">cbarsizeh</span> <span class="o">..</span> <span class="s2">"}"</span><span class="p">)</span>

<span class="n">tex</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">heatcolorbar"</span><span class="p">)</span>
</code></pre></div></div> <h5 style="text-align: center;"> <em> With this approach we keep as much as possible the LaTeX instructions outside of Lua scripts, and vice versa. </em> </h5> <p><br> The overlap between LaTeX and Lua is confined to the environment</p> <div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{tikzpicture}</span>[fg]
  <span class="nt">\begin{luacode*}</span>
    <span class="c">% [...]</span>
  <span class="nt">\end{luacode*}</span>
<span class="nt">\end{tikzpicture}</span>
</code></pre></div></div> <p>where we orchestrate the interactions between the user input parameters, the Lua logic, and the style of the plots expressed in LaTeX.</p> <h3 id="examples-of-run">Examples of run</h3> <p>Generating different grids of heatmaps requires only changing the parameters of the <code class="language-plaintext highlighter-rouge">config.lua</code> file.</p> <h4 id="example-1">Example 1</h4> <figure class="highlight"><pre><code class="language-lua" data-lang="lua"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td> <td class="code"><pre><span class="c1">-- config.lua</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">config</span><span class="p">.</span><span class="n">gridcols</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">config</span><span class="p">.</span><span class="n">relativesize</span> <span class="o">=</span> <span class="p">.</span><span class="mi">24</span>
<span class="n">config</span><span class="p">.</span><span class="n">dircsv</span> <span class="o">=</span> <span class="s2">"./data/csv/heatmaps"</span>
<span class="n">config</span><span class="p">.</span><span class="n">plots</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span><span class="s2">"left_sbs"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{l-sbs}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"right_sbs"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{r-sbs}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"flexible_sbs"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{f-sbs}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"left_dbd"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{l-dbd}"</span><span class="p">},</span>
<span class="p">}</span>

<span class="k">return</span> <span class="n">config</span>
</pre></td> </tr></tbody></table></code></pre></figure> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/texfantasy/tuto_heatmaps_lua/example1-480.webp 480w,/assets/img/texfantasy/tuto_heatmaps_lua/example1-800.webp 800w,/assets/img/texfantasy/tuto_heatmaps_lua/example1-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/texfantasy/tuto_heatmaps_lua/example1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Example with four heatmaps in one row. </div> <h4 id="example-2">Example 2</h4> <figure class="highlight"><pre><code class="language-lua" data-lang="lua"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td> <td class="code"><pre><span class="c1">-- config.lua</span>

<span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">config</span><span class="p">.</span><span class="n">gridcols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">config</span><span class="p">.</span><span class="n">relativesize</span> <span class="o">=</span> <span class="p">.</span><span class="mi">3</span>
<span class="n">config</span><span class="p">.</span><span class="n">dircsv</span> <span class="o">=</span> <span class="s2">"./data/csv/heatmaps"</span>
<span class="n">config</span><span class="p">.</span><span class="n">plots</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span><span class="s2">"left_sbs"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{l-sbs}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"right_sbs"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{r-sbs}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"flexible_sbs"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{f-sbs}"</span><span class="p">},</span>
  <span class="p">{</span><span class="s2">"left_dbd"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">textsc{l-dbd}"</span><span class="p">},</span>
<span class="p">}</span>

<span class="k">return</span> <span class="n">config</span>
</pre></td> </tr></tbody></table></code></pre></figure> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/texfantasy/tuto_heatmaps_lua/example2-480.webp 480w,/assets/img/texfantasy/tuto_heatmaps_lua/example2-800.webp 800w,/assets/img/texfantasy/tuto_heatmaps_lua/example2-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/texfantasy/tuto_heatmaps_lua/example2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Example with a two by two grid. </div> <h3 id="other-lua-powered-figures">Other Lua-powered figures</h3> <p>The same system combining Lua config file and Lua scripts with a TikZ/PGFPlots project can be used to draw many different scientific figures. Find below a few other examples:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <a href="http://bvieuble.me/texfantasy/19_tex/" rel="external nofollow noopener" target="_blank"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/texfantasy/tex19-front-480.webp 480w,/assets/img/texfantasy/tex19-front-800.webp 800w,/assets/img/texfantasy/tex19-front-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/texfantasy/tex19-front.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </a> </div> <div class="col-sm mt-3 mt-md-0"> <a href="http://bvieuble.me/texfantasy/20_tex/" rel="external nofollow noopener" target="_blank"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/texfantasy/tex20-front-480.webp 480w,/assets/img/texfantasy/tex20-front-800.webp 800w,/assets/img/texfantasy/tex20-front-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/texfantasy/tex20-front.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </a> </div> </div> <div class="caption"> Other figures of the TeXFantasy collection using Lua. Click on the image to see the full plot. </div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/china-life-1/">Coming to live in China, trash your cloud services and get yourself a NAS!</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/chinavisit4/">Academic visit in China (TODO list)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/chinavisit3/">Academic visit in China (3/3)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/chinavisit2/">Academic visit in China (2/3)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/chinavisit1/">Academic visit in China (1/3)</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2026 Bastien Vieublé. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>